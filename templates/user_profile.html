
<html>
    <head>
    <meta charset="UTF-8">
    <link rel='stylesheet/less' href='../css/styles.less'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js" ></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="icon" type="image/png" href="/prologes/img/favicon.png" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    </head>
    <body>
    <!-- NAVBAR -->
    <header class="header">
      <nav role="navigation" class="navbar navbar-custom navbar-default navbar-fixed-top">
      <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand-image"><img src="../img/prologes.png" class="navlogo logo"/></a>
        </div>
        <!-- Collection of nav links, forms, and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
        <li class='dropdown'>
          <a data-toggle='dropdown' class='dropdown-toggle' href='#'>
            <div class='lang-selector'>
              EN				</div>
          </a>
          <ul role='menu' class='dropdown-menu'>
            <li>
              <a href="#">English</a>
              </li>
            <li>
              <a href="#">Espa√±ol</a>
              </li>
          </ul>
        </li>
    
        <li>
          <form role="search" class="navbar-form navbar-right" action="/prologes/search">
              <div class="input-group">
                <input type="text" placeholder="Search" name="q" class="form-control input-sm">
                <span class="input-group-btn">
                  <button class="btn btn-default input-sm" type="submit">
                    <span class="fas fa-search"></span>
                  </button>
                </span>
              </div>
          </form>
        </li>
            
                <!-- NOT LOGGED IN -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                      <div class="user-header">
                        <div class="user-profile-pic">
                          <!--<img src="img/defaultUser.png" class="" />-->
                        </div>
                        <div class="user-display-name">username</div>
                      </div>
                      <!--<img src="img/defaultUser.png" class="profile-pic" />!-->
                      <!--Tin Kalzetin-->
                    </a>
                    <ul role="menu" class="dropdown-menu">
                        <li><a href="#">Profile</a></li>
                        <li><a href="#">Library</a></li>
                        <li><a href="#">Book clubs</a></li>
                        <li><a href="#">Log out</a></li>
                    </ul>
                  </li>	
        <!-- LOGGED IN -->
                </ul>
        </div>
        </div>
      </nav>
    </header>
    
    <!-- MAIN BODY -->
    <div class="container">
      <div class="col-sm-12">
        <div class="prlg-panel">
          <div class="main-profile">
            <div class="icon-section">
              <div class="croppable-wrapper" id="croppable-wrapper">
                <div class="croppable" id="croppable"></div>
              </div>
              <div class="icon" id="avatar-display--area">
                <img src="../img/user_dark.png">
              </div>
              <div class="actions change-icon" id="change-avatar--buttons">
                <div class="upload-btn">
                  <input type="file" id="avatar-upload" name="avatar">
                  <label class="btn" for="avatar-upload">Change Avatar</label>
                </div>
              </div>
              <div class="actions edit-avatar" id="save-avatar--buttons"></div>
              <!-- Here the croppie or whatever-->
            </div>
            <div class="info-section">
              <div class="info">
                <div class="section">
                  <div class="field-name">Display name</div>
                  <div class="field-editable"></div>
                  <div class="field-value">
                    <div class="value display-name">Your Display Name</div>
                    <div class="action" tabindex="0" role="button" id="edit-user--displayname">
                      <i class="fas fa-pen"></i>
                    </div>
                  </div>
                </div>
                <div class="section">
                  <div class="field-name">Display name</div>
                  <div class="field-editable">
                    <div class="editable-area display-name">
                      <div class="wrapper contained">
                        <input type="input">
                        <i class="action cancel fas fa-times" title="Cancel" tabindex="0" role="button"></i>
                        <i class="action submit fas fa-check" title="Save" tabindex="0" role="button"></i>
                      </div>
                    </div>
                    <div class="actions">
                      <button class="btn">Cancel</button>
                      <button class="btn main-btn">Save</button>
                    </div>
                    <!-- <div class="actions">
                      <i class="fas fa-check"></i>
                      <i class="fas fa-times"></i>
                    </div> -->
                  </div>
                </div>
                <div class="section">
                  <div class="field-name">Username</div>
                  <div class="field-value">
                    <div class="value username">@usernmae</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <!-- Finish MAIN BODY -->
    </div>
    
    <!-- FOOTER -->
    <footer>
      <div class="container">
        <h5>Prologes &copy; 2016 
          <ul class="pull-right list-inline">
            <li><a href="about">About us</a></li>
            <li><a href="privacy">Terms and privacy</a></li>
          </ul>
        </h5>
      </div>
    </footer>
    </body>
    </html>
    <script>
    var croppable;

    function cancelAvatarChange() {
      return function() {
        // Hide croppable
        console.log('removing cropability');
        croppable = null;
        $('#avatar-display--area').css('display', 'flex');
        $('#croppable-wrapper').empty().append($('<div></div>', {class: "croppable", id: "croppable"}));
        $('#save-avatar--buttons').empty();
      };
    }

    var createEditable = function(value, save, cancel, validate) {
      if(validate === undefined) {
        validate = function(input) {
          return input !== '' && input.length < 25;
        };
      }
      var input = $('<input>', {type: 'input'}).val(value);
      // var cancelIcon = $('<i></i>', {class: 'action cancel fas fa-times', title: 'Cancel', tabindex: "0", role: 'button'}).on('click', cancel);
      // var saveIcon = $('<i></i>', {class: 'action submit fas fa-check', title: 'Cancel', tabindex: "0", role: 'button'}).on('click', save);
      var wrapper = $('<div></div>', {class: 'wrapper contained'}).append(input);
      // .append(cancelIcon).append(saveIcon);
      var inputHolder = $('<div></div>', {class: 'editable-are display-name'}).append(wrapper);

      var cancelButton = $('<button></button>', {class: 'btn', title: 'Cancel', tabindex: "0", role: 'button'}).on('click', cancel).append(' Cancel');
      var saveButton = $('<button></button>', {class: 'btn main-btn', title: 'Cancel', tabindex: "0", role: 'button'}).on('click', function() {
        var inputValue = input.val();
        if(validate(inputValue)) {
          save(inputValue);
        } else {
          //
        }
      }).append('Save');
      var controls = $('<div></div>', {class: 'actions'}).append(cancelButton).append(saveButton);

      var holder = $('<div></div>', {class: 'editable-area display-name'}).append(inputHolder).append(controls);
      return holder;
    };

    
    $(document).ready(function() {

      $('#edit-user--displayname').on('click', function() {
        // clean all others
        $('.field-editable').empty();
        $('.field-value').css('display', 'flex');
        // find the section
        var section = $(this).closest('.section');
        var editable = section.find('.field-editable');
        var value = section.find('.field-value');

        value.css('display', 'none');
        var editableArea = createEditable(value.find('.value').text(), function(newValue) {
          section.find('.field-value .value').empty().append(document.createTextNode(newValue));
          $('.field-editable').empty();
          $('.field-value').css('display', 'flex');
        }, function() {
          $('.field-editable').empty();
          $('.field-value').css('display', 'flex');
        });
        editable.append(editableArea);
        section.find('input').focus();
      });

      $('#avatar-upload').change(function() {
        if(croppable == null) {
          //
          croppable = $('.croppable').croppie({
            enableExif: true,
            viewport: {
              width: 200,
              height: 200,
              type: 'circle'
            },
            boundary: {
              width: 250,
              height: 250
            }
          });
          var saveButton = $('<button></button>', {class: 'btn main-btn'}).append('Save');
          var cancelButton = $('<button></button>', {class: 'btn cancel-btn'}).append('Cancel').on('click', cancelAvatarChange());
          $('#save-avatar--buttons').append(cancelButton).append(saveButton);
        }
        $('#avatar-display--area').css('display', 'none');
        var reader = new FileReader();
        reader.onload = function(e) {
          croppable.croppie('bind', {
            url: e.target.result
          }).then(function() {
            console.log('bind complete');
          });
        };
        reader.readAsDataURL(this.files[0]);
      });
      $('#edit-icon').one('click', function() {
        console.log('editable now');
        showEditable('Editable name', 'Editable description\nOver multiple\nLines');
      });
    });
    </script>